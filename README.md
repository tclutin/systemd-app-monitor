# systemd-app-monitor

## Описание

---

**systemd-app-monitor** — позволяет создавать мониторы для systemd-севрисов, которые автоматически проверяют доступность сервиса по указанному URL с заданным интервалом и перезапускают systemd-сервис в случае недоступности.

---

Проект состоит из двух скриптов:

- **monitor.sh** — проверяет доступность указанного URL и при необходимости автоматически перезапускает соответствующий systemd-сервис (основной скрипт)
- **install.sh** — устанавливает monitor.sh для сервиса, создаёт systemd service + timer, также учавствует в удалении скрипта мониторинга
---

## Установка
```bash
git clone https://github.com/<username>/systemd-app-monitor.git
cd systemd-app-monitor
chmod +x install.sh
```

## Использование `install.sh`
> ⚠️ Для установки требуется root-доступ, так как скрипт создаёт systemd-unit файлы и работает с системными директориями.

Установка мониторинга для сервиса (по умолчанию проверка каждые 30 секунд)
```bash
sudo ./install.sh --url http://localhost:8080/healthz --service myapp
```

Установка с кастомным интервалом (например, каждые 15 секунд)
```bash
sudo ./install.sh --url http://localhost:8080/healthz --service myapp --interval 15
```

Обновление скрипта мониторинга (при правках в самом monitor.sh)
```bash
sudo ./install.sh --url http://localhost:8080/healthz --service myapp --update
```

Удаление мониторинга конкретного сервиса
```bash
sudo ./install.sh --url http://localhost:8080/healthz --service myapp --delete
```

Просмотр дополнительной информации
```bash
./install.sh --help
```

## Аргументы `install.sh`

| Флаг             | Описание                                           | Обязательно | Пример                                |
|------------------|----------------------------------------------------|-------------|---------------------------------------|
| `--url URL`      | URL, который будет проверяться через `curl`        | ✅          | `--url http://localhost:8080/healthz` |
| `--service NAME` | systemd-сервис, который нужно перезапускать        | ✅          | `--service myapp`                     |
| `--interval N`   | Интервал проверки в секундах                       | ❌ (30 по умолчанию) | `--interval 15`                       |
| `--update`       | Обновляет установленный монитор (перезапись скрипта) | ❌ | `--update`                            |
| `--delete`       | Удаляет мониторинг и связанные systemd units       | ❌          | `--delete`                            |
| `--help`         | Просмотр доп.информации         | ❌          | `--help`                              |

## Использование `monitor.sh`
```bash
sudo ./monitor.sh --url http://localhost:8080/healthz --service myapp
```

Просмотр дополнительной информации
```bash
./monitor.sh --help
```

## Аргументы `monitor.sh`

| Флаг             | Описание                                    | Обязательно | Пример                                |
|------------------|---------------------------------------------|-------------|---------------------------------------|
| `--url URL`      | URL, который будет проверяться через `curl` | ✅          | `--url http://localhost:8080/healthz` |
| `--service NAME` | systemd-сервис, который нужно перезапустить | ✅          | `--service myapp`                     |
| `--help`         | Просмотр доп.информации                     | ❌          | `--help`                              |

---

## Просмотр логов

Просмотр логов монитора
```bash
journalctl -u monitor_<service>.service -f
```

Просмотров логов таймера
```bash
journalctl -u monitor_<service>.timer -f
```

---

> В рамках задания также был написан простой http-сервер по пути ./app, но автоматическое развертывание данного сервиса не было предусмотрено техническим заданием и служит он примером. Технически любой сервис, который имеет health-check и запущен в виде system-unit будет работать с данным скриптом.
